import json
from html.parser import HTMLParser

# Custom HTML parser to strip tags
class MLStripper(HTMLParser):
    def __init__(self):
        super().__init__()
        self.reset()
        self.strict = False
        self.convert_charrefs= True
        self.fed = []

    def handle_data(self, d):
        self.fed.append(d)

    def get_data(self):
        return ''.join(self.fed)

def strip_tags(html):
    s = MLStripper()
    s.feed(html)
    return s.get_data()

# Load the JSON data
with open('report.json', 'r') as json_file:
    data = json.load(json_file)

# Extract relevant fields from the JSON and clean HTML tags
cleaned_data = []
for site in data['site']:
    for alert in site['alerts']:
        cleaned_alert = {
            'risk name': alert['name'],
            'risk level': alert['riskdesc'],
            'risk description': strip_tags(alert['desc']),  # Strip HTML tags from 'desc'
            'solution': strip_tags(alert['solution'])  # Strip HTML tags from 'solution'
        }
        cleaned_data.append(cleaned_alert)
# If you want to write cleaned data to a new JSON file:
with open('cleaner.json', 'w') as output_file:
     json.dump(cleaned_data, output_file, indent=4)
